name: Build Android APK

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. æ‹‰å–ä»£ç 
    - uses: actions/checkout@v4

    # 2. è®¾ç½® Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    # 3. è®¾ç½® Java (å®‰å“æ‰“åŒ…å¿…é¡»)
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    # 4. è®¾ç½® Flutter
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: "3.24.x"
        channel: "stable"

    # 5. ğŸ”¥ æ ¸å¿ƒä¿®æ”¹ï¼šå®‰è£…å’Œæ‰“åŒ…åˆå¹¶åœ¨è¿™ä¸€æ­¥ ğŸ”¥
    # è¿™æ ·èƒ½ä¿è¯ flet å‘½ä»¤ç»å¯¹èƒ½è¢«æ‰¾åˆ°
    - name: Install and Build
      run: |
        # æ›´æ–° pip
        python -m pip install --upgrade pip
        
        # å¼ºåˆ¶å®‰è£…ä¾èµ– (ä¸ä¾èµ–æ–‡ä»¶ï¼Œé˜²æ­¢æ–‡ä»¶è¯»ä¸åˆ°)
        pip install flet requests urllib3
        
        # ç¡®ä¿ pip å®‰è£…çš„å¯æ‰§è¡Œæ–‡ä»¶åœ¨ç³»ç»Ÿè·¯å¾„ä¸­ (åŒé‡ä¿é™©)
        export PATH=$PATH:$HOME/.local/bin
        
        # éªŒè¯ flet æ˜¯å¦å®‰è£…æˆåŠŸ (è¿™ä¸€æ­¥ä¼šåœ¨æ—¥å¿—é‡Œæ˜¾ç¤ºä½ç½®ï¼Œæ–¹ä¾¿æ’é”™)
        which flet || echo "Flet not found in PATH"
        
        # å¼€å§‹æ‰“åŒ…
        # ä½¿ç”¨ yes | è‡ªåŠ¨å›ç­”æ‰€æœ‰ "y/n" é—®é¢˜ï¼Œé˜²æ­¢å¡æ­»
        # ä½¿ç”¨ --verbose æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
        yes | flet build apk --verbose

    # 6. ä¸Šä¼ ç»“æœ
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: ForumRadar_APK
        path: "**/*.apk"
