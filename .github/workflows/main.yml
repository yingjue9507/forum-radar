name: Build Android APK

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: "3.24.x"
        channel: "stable"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install flet requests urllib3

    # === ğŸ” ç¬¬ä¸€æ­¥ï¼šç¡®è®¤æ–‡ä»¶ç»“æ„ ===
    - name: Check file structure
      run: ls -R

    # === ğŸ› ï¸ ç¬¬äºŒæ­¥ï¼šæ‰“åŒ… ===
    # æ³¨æ„ï¼šè¿™é‡Œæ ¹æ®ä½ ä¹‹å‰çš„æˆªå›¾ï¼Œå‡è®¾ä»£ç åœ¨ app1.0/3.0.py
    # å¦‚æœä½ å·²ç»ç§»åˆ°äº†æ ¹ç›®å½•å¹¶æ”¹åä¸º main.pyï¼Œè¯·æ”¹ä¸º: yes | flet build apk --verbose
    - name: Build APK
      run: |
        yes | flet build apk app1.0/3.0.py --verbose

    # === ğŸ” ç¬¬ä¸‰æ­¥ï¼šæ‰¾å‡ºç”Ÿæˆçš„ APK åœ¨å“ªé‡Œ ===
    # è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è°ƒè¯•ï¼Œå¦‚æœä¸Šä¼ å¤±è´¥ï¼ŒæŸ¥çœ‹è¿™ä¸€æ­¥çš„æ—¥å¿—èƒ½çŸ¥é“æ–‡ä»¶åœ¨å“ª
    - name: Locate APK file
      run: find . -name "*.apk"

    # === ğŸ“¦ ç¬¬å››æ­¥ï¼šä¸Šä¼  APK (å…³é”®ä¿®æ”¹) ===
    # ä½¿ç”¨ **/*.apk é€šé…ç¬¦ï¼Œæ— è®ºæ–‡ä»¶è—åœ¨å“ªä¸ªç›®å½•ä¸‹éƒ½èƒ½æ‰¾åˆ°
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: app-release
        path: "**/*.apk"
