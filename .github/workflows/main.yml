name: Build Android APK

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: "3.24.x"
        channel: "stable"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install flet requests urllib3

    # === ğŸ” è°ƒè¯•æ­¥éª¤ï¼šæŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨ ===
    - name: Check file list
      run: ls -R

    # === ğŸ› ï¸ å…³é”®ä¿®æ”¹ï¼šæŒ‡å®šæ–‡ä»¶å ===
    # è¯·ç¡®è®¤ä½ çš„ä»“åº“é‡Œ Python æ–‡ä»¶åæ˜¯å¦å« 3.0.py
    # å¦‚æœä½ å·²ç»æ”¹åä¸º main.pyï¼Œè¯·æŠŠä¸‹é¢å‘½ä»¤é‡Œçš„ 3.0.py æ”¹æˆ main.py
    - name: Build APK
      run: |
        yes | flet build apk 3.0.py --verbose

    # === ğŸ” è°ƒè¯•æ­¥éª¤ï¼šå¯»æ‰¾ç”Ÿæˆçš„ APK ä½ç½® ===
    # å¦‚æœæ‰“åŒ…æˆåŠŸï¼Œè¿™ä¸€æ­¥ä¼šæ‰“å°å‡º APK çš„å…·ä½“ä½ç½®
    - name: Find APK
      run: find . -name "*.apk"

    # === ğŸ“¦ å…³é”®ä¿®æ”¹ï¼šä½¿ç”¨é€šé…ç¬¦ä¸Šä¼  ===
    # path: "**/*.apk" ä¼šè‡ªåŠ¨æŠ“å–ä»»ä½•æ–‡ä»¶å¤¹ä¸‹çš„ apk æ–‡ä»¶
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: app-release
        path: "**/*.apk"
